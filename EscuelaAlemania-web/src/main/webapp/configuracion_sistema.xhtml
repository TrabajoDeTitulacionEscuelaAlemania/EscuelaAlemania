<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="plantilla.xhtml">

       
        <ui:define name="init">

            <f:metadata>
                <f:event type="preRenderView" listener="#{managedBeanConfiguracionSistema.init}" />
            </f:metadata> 

        </ui:define>
        
       
        
        <ui:define name="alerta">
            
            
            <li class="dropdown">
                           
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <span class="top-label label label-danger"><p:outputLabel value="#{managedBeanConfiguracionSistema.alertasTotal}" id="alertas1"/></span>  <i class="fa fa-bell fa-3x"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-alerts">
                                <li>
                                    <a href="alertas.xhtml">
                                        <div>
                                            <i class="fa fa-comment fa-fw"></i>Alertas del sistema
                                            <span class="pull-right text-muted small"><p:outputLabel value="#{managedBeanConfiguracionSistema.alertas}" id="alertas2"/></span>
                                        </div>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="alertas_usuario.xhtml">
                                        <div>
                                            <i class="fa fa-twitter fa-fw"></i>Alertas de usuarios
                                            <span class="pull-right text-muted small"><p:outputLabel value="#{managedBeanConfiguracionSistema.alertasUsuario}" id="alertas3"/></span>
                                        </div>
                                    </a>
                                </li>


                            </ul>
                            <!-- end dropdown-alerts -->
                            
                        </li>
               
            
        </ui:define>


        <ui:define name="contenido">
            <h:form id="form">
                <p:growl id="growl" showDetail="true" />
                <div id="page-wrapper">

                    <div class="row">
                        <!-- Page Header -->
                        <div class="col-lg-12">
                            <p:outputLabel class="page-header" value="Configuración del sistema" style="font-size: 33px "/>
                        </div>
                        <!--End Page Header -->
                    </div>
                    
                    <p:outputPanel deferred="true" rendered="#{managedBeanConfiguracionSistema.rol != 'Administrador'}">
                        <h3>Información no disponible</h3>
                        <p>Usted no posee los privilegios necesarios para utilizar esta funcionalidad</p>
                    </p:outputPanel>

                    
                    <h:panelGroup class="panel panel-default" layout="block" rendered="#{managedBeanConfiguracionSistema.rol eq 'Administrador'}">
                        
                        <div class="panel-body">
                            
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#cuentas-usuario" data-toggle="tab">Cuentas de usuario</a>
                                </li>
                                <li><a href="#parametros-sistema" data-toggle="tab">Parametros del sistema</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                
                                <div class="tab-pane fade in active" id="cuentas-usuario" >
                                    <br/>
                                    <p:commandButton value="Cambiar contraseña de usuario" class="btn btn-outline btn-success"
                                                     update=":form:cambiarPass" onclick="PF('cambiarPass').show()" action="#{managedBeanConfiguracionSistema.irCambiarContraseña()}" />
                                    <p:commandButton value="Asociar un correo a esta cuenta" class="btn btn-outline btn-success" 
                                                     disabled="#{managedBeanConfiguracionSistema.usuario eq 'admin'}"
                                                     update=":form:asociarMail" onclick="PF('asociarMail').show()" action="#{managedBeanConfiguracionSistema.irAsociarCorreo()}"/>
                                    <p:commandButton value="Cambiar contraseña del usuario Visitante" class="btn btn-outline btn-success" disabled="#{managedBeanConfiguracionSistema.usuario != 'admin'}"
                                                     update=":form:cambiarPassV" onclick="PF('cambiarPassV').show()" action="#{managedBeanConfiguracionSistema.irCambiarVisitante()}"/>
                                    <br/>
                                    <br/>
                                    <p:contextMenu for="Usuarios">
                                        <p:menuitem value="Reestablecer contraseña" update="reestablecerPass" onclick="PF('reestablecerPass').show()" action="#{managedBeanConfiguracionSistema.irReestablecer()}"/>
                                        <p:menuitem value="Eliminar usuario" update="eliminarUser" onclick="PF('eliminarUser').show()" action="#{managedBeanConfiguracionSistema.irEliminar()}"/>
                                    </p:contextMenu>
                                    <p:dataTable rendered="#{managedBeanConfiguracionSistema.usuario eq 'admin'}" id="Usuarios" var="user" value="#{managedBeanConfiguracionSistema.usuarios}"  rows="5"
                                                 paginator="true"  rowsPerPageTemplate="5,10,15" emptyMessage="No existen usuario"  rowKey="#{user.id}"
                                    paginatorPosition="top" selection="#{managedBeanConfiguracionSistema.usuarioSeleccionado}" selectionMode="single">
                                        <f:facet name="header">
                                            Lista de usuarios del sistema
                                        </f:facet>
                                        <p:column headerText="Nombre de usuario" footerText="">
                                            <h:outputText value="#{user.usuario}" />
                                        </p:column>
                                        <f:facet name="footer">
                                            <p:commandButton update=":form:crearUser" icon="ui-icon-plusthick" title="Crear usuario" onclick="PF('crearUser').show();" 
                                                             action="#{managedBeanConfiguracionSistema.irCrear()}"/>
                                        </f:facet>
                                    </p:dataTable>
                                    
                                    <p:dialog  header="Reestablecer contraseña" widgetVar="reestablecerPass" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="reestablecerPass" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="1" rendered="#{not empty managedBeanConfiguracionSistema.usuarioSeleccionado}"  >

                                                <p:outputLabel value="Al reestablecer la contraseña de este usuario, esta será 
                                                               el mismo valor que su nombre de usuario. Es decir, la contraseña será #{managedBeanConfiguracionSistema.nombreUsuarioReestablecer}" />
                                                <br/>
                                                <p:outputLabel value="¿Desea reestablecer la contraseña de este usuario?" />

                                            </h:panelGrid>
                                            <p:commandButton  value="Si" action="#{managedBeanConfiguracionSistema.reestablecerContraseña()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                            <p:spacer width="3" />
                                            <p:commandButton  value="No" onclick="PF('reestablecerPass').hide();" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Eliminar usuario" widgetVar="eliminarUser" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="eliminarUser" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="1" rendered="#{not empty managedBeanConfiguracionSistema.usuarioSeleccionado}"  >

                                                <p:outputLabel value="¿Desea eliminar el usuario seleccionado?" />

                                            </h:panelGrid>
                                            <p:commandButton  value="Si" action="#{managedBeanConfiguracionSistema.eliminarUsuario()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                            <p:spacer width="3" />
                                            <p:commandButton  value="No" onclick="PF('eliminarUser').hide();" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Nuevo usuario" widgetVar="crearUser" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="crearUser" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2">

                                                <p:outputLabel value="Nuevo usuario: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.nombreUsuarioCrear}" maxlength="15"/>
                                            </h:panelGrid>
                                            <p:outputLabel value="La contraseña será el nombre de usuario" style="font-weight: bold; " />
                                            <br/>
                                            <br/>
                                            <p:commandButton  value="Crear usuario" action="#{managedBeanConfiguracionSistema.crearUsuario()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Cambiar contraseña" widgetVar="cambiarPass" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="cambiarPass" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2">

                                                <p:outputLabel value="Ingrese su nueva contraseña: " />
                                                <p:password value="#{managedBeanConfiguracionSistema.contraseña1}" maxlength="100"/>
                                                <p:outputLabel value="Vuelva a introducir su nueva contraseña: " />
                                                <p:password value="#{managedBeanConfiguracionSistema.contraseña2}" maxlength="100"/>
                                                <p:outputLabel value="Ingrese su contraseña actual: " />
                                                <p:password value="#{managedBeanConfiguracionSistema.contraseñaActual}" maxlength="100"/>
                                            </h:panelGrid>
                                            <p:commandButton  value="Cambiar contraseña" action="#{managedBeanConfiguracionSistema.cambiarContraseña()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Asociar correo electrónico" widgetVar="asociarMail" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="asociarMail" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2">

                                                <p:outputLabel value="Ingrese el correo que desea asociar a su cuenta: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.correoUsuario}" maxlength="70"/>
                                            </h:panelGrid>
                                            <p:commandButton  value="Asociar correo" action="#{managedBeanConfiguracionSistema.asociarCorreo()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Cambiar contraseña Visitante" widgetVar="cambiarPassV" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="cambiarPassV" style="display:block; text-align:center;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2">

                                                <p:outputLabel value="Ingrese la nueva contraseña para el Visitante: " />
                                                <p:password value="#{managedBeanConfiguracionSistema.contraseñaVisitante1}" maxlength="100"/>
                                                <p:outputLabel value="Reingrese la nueva contraseña para el Visitante: " />
                                                <p:password value="#{managedBeanConfiguracionSistema.contraseñaVisitante2}" maxlength="100"/>
                                            </h:panelGrid>
                                            <p:commandButton  value="Cambiar contraseña" action="#{managedBeanConfiguracionSistema.cambiarContraseñaVisitante()}"
                                                              update=":form:growl :form:Usuarios @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    
                                </div>
                                
                                <div class="tab-pane fade" id="parametros-sistema" >
                                    
                                    <p:outputPanel deferred="true" rendered="#{managedBeanConfiguracionSistema.usuario != 'admin'}">
                                        <h3>Información no disponible</h3>
                                        <p>Usted no posee los privilegios necesarios para utilizar esta funcionalidad</p>
                                    </p:outputPanel>
                                    
                                    <p:dataTable id="PS" var="ps" value="#{managedBeanConfiguracionSistema.parametrosSistema}"  rows="5"
                                    paginator="true"  rowsPerPageTemplate="5,10,15" emptyMessage="No existen parametros"  
                                    paginatorPosition="top" rendered="#{managedBeanConfiguracionSistema.usuario eq 'admin'}">
                                    
                                        <f:facet name="header">
                                            Lista de parametros del sistema
                                        </f:facet>
                                        
                                        <p:column headerText="Nombre parametro" footerText="">
                                            <h:outputText value="#{ps.tipoParametro}" />
                                        </p:column>

                                        <p:column headerText="Valor parametro" footerText="">
                                            <h:outputText value="#{ps.valor}" />
                                        </p:column>
                                        
                                        <p:column style="width:110px; text-align: center" >

                                            <p:commandButton update="@([id$=editarPS])" oncomplete="PF('editarPS').show()" title="Editar" 
                                                             icon="ui-icon-pencil" ajax="true" action="#{managedBeanConfiguracionSistema.irEditarParametro()}">
                                                <f:setPropertyActionListener value="#{ps}" target="#{managedBeanConfiguracionSistema.parametroSistemaSeleccionado}" />
                                            </p:commandButton> 
                                        </p:column>
                                    
                                    </p:dataTable>
                                    <br/>
                                    <br/>
                                    <br/>
                                    <p:dataTable id="CM" var="cm" value="#{managedBeanConfiguracionSistema.configuracionMails}"  rows="5"
                                    paginator="true"  rowsPerPageTemplate="5,10,15" emptyMessage="No existen parametros"  
                                    paginatorPosition="top" rendered="#{managedBeanConfiguracionSistema.usuario eq 'admin'}">
                                    
                                        <f:facet name="header">
                                            Lista de parametros avanzados del sistema
                                        </f:facet>
                                        
                                        <p:column headerText="Nombre parametro" footerText="">
                                            <h:outputText value="#{cm.tipo}" />
                                        </p:column>

                                        <p:column headerText="Valor parametro" footerText="">
                                            <h:outputText value="#{cm.valor}" />
                                        </p:column>
                                        
                                        <p:column style="width:110px; text-align: center" >

                                            <p:commandButton update="@([id$=editarCM])" oncomplete="PF('editarCM').show()" title="Editar" 
                                                             icon="ui-icon-pencil" ajax="true" action="#{managedBeanConfiguracionSistema.irEditarConfiguracionMail()}">
                                                <f:setPropertyActionListener value="#{cm}" target="#{managedBeanConfiguracionSistema.configuracionMailSeleccionado}" />
                                            </p:commandButton> 
                                        </p:column>
                                    
                                    </p:dataTable>
                                    
                                    <p:dialog  header="Modificar parametros del sistema" widgetVar="editarPS" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="editarPS" style="display:block; text-align:left;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2" rendered="#{not empty managedBeanConfiguracionSistema.parametroSistemaSeleccionado}">

                                                <p:outputLabel value="Nombre del parametro: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.nombreParametroSistema}" maxlength="50"/>
                                                <p:outputLabel value="Valor: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.valorParametroSistema}" maxlength="50"/>
                                            </h:panelGrid>
                                            <p:commandButton  value="Aceptar" action="#{managedBeanConfiguracionSistema.editarParametroSistema()}"
                                                              update=":form:growl :form:PS @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                    <p:dialog  header="Modificar parametros avanzados del sistema" widgetVar="editarCM" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                                        <p:outputPanel id="editarCM" style="display:block; text-align:left;margin: 0 auto;">
                                            <h:panelGrid  border="0" columns="2" rendered="#{not empty managedBeanConfiguracionSistema.configuracionMailSeleccionado}">

                                                <p:outputLabel value="Nombre del parametro: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.nombreConfiguracionMail}" maxlength="50"/>
                                                <p:outputLabel value="Valor: " />
                                                <p:inputText value="#{managedBeanConfiguracionSistema.valorConfiguracionMail}" maxlength="50"/>
                                            </h:panelGrid>
                                            <p:commandButton  value="Aceptar" action="#{managedBeanConfiguracionSistema.editarConfiguracionMail()}"
                                                              update=":form:growl :form:CM @([id$=alertas1]) @([id$=alertas2]) @([id$=alertas3])" />
                                        </p:outputPanel>
                                    </p:dialog>
                                    
                                </div>
                                
                            </div>
                            
                        </div>
                        
                    </h:panelGroup>

                    

                </div>
            </h:form>
        </ui:define>


       

    </ui:composition>
</html>

